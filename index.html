<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/youtube/icons/icon-192x192.png">
    <link rel="manifest" href="/youtube/manifest.json">
    <title>Clould Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/eclipse.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/matchesonscrollbar.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/scroll/annotatescrollbar.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/matchesonscrollbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/jump-to-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/pulltorefreshjs@0.1.22/dist/index.css">
    <script src="https://unpkg.com/pulltorefreshjs@0.1.22/dist/index.umd.js"></script>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --surface-color: #ffffff;
            --sidebar-color: #f7f8fa;
            --primary-text: #050505;
            --secondary-text: #65676b;
            --accent-color: #1b74e4;
            --border-color: #dddfe2;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html,
        body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text);
        }
        .app-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        #main-tabs {
            display: flex;
            align-items: center;
            gap: 8px;
            /* âœ¨ ë²„íŠ¼ ì‚¬ì´ì— ì•½ê°„ì˜ ê°„ê²©ì„ ì¤ë‹ˆë‹¤. */
        }
        #auth-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
            /* âœ¨ ì™¼ìª½ ì—¬ë°±ì„ ìë™ìœ¼ë¡œ ì„¤ì •í•´ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°€ì–´ëƒ…ë‹ˆë‹¤ */
        }
        .main-tab-btn {
            padding: 12px 16px;
            /* âœ¨ ì¢Œìš° ì—¬ë°±ì„ ëŠ˜ë ¤ì¤ë‹ˆë‹¤. */
            border: none;
            border-bottom: 3px solid transparent;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--secondary-text);
            cursor: pointer;
            white-space: nowrap;
            /* âœ¨ ê¸€ìê°€ ì ˆëŒ€ ì¤„ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. */
        }
        .main-tab-btn.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }
        .input-column,
        .list-column {
            flex-grow: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            padding: 24px;
        }
        .list-column {
            display: none;
        }
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        #clearAllBtn {
            background: none;
            border: none;
            color: var(--secondary-text);
            cursor: pointer;
            font-weight: 600;
        }
        #clearAllBtn:hover {
            color: #e02c4f;
        }
        h2 {
            font-size: 20px;
            margin: 0;
        }
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            background-color: var(--surface-color);
            border-radius: 12px;
            padding: 6px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: var(--secondary-text);
            border-radius: 8px;
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        .tab-btn:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }
        .tab-btn.active {
            color: var(--accent-color);
            background-color: var(--bg-color);
            box-shadow: 0 1px 3px var(--shadow-color);
        }
        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 15px;
            background-color: var(--surface-color);
        }
        #saveBtn {
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: auto;
            flex-shrink: 0;
        }
        #saveBtn:hover {
            background-color: #1868cd;
        }
        #saveBtn:disabled {
            background-color: #e0e0e0;
            color: #a0a0a0;
            cursor: not-allowed;
        }
        #textInput-container,
        #linkInput-container,
        #fileInput-container,
        #htmlInput-container {
            flex-grow: 1;
            display: none;
            flex-direction: column;
            min-height: 0;
        }
        .input-column>#textInput-container {
            display: flex;
        }
        #textInput {
            flex-grow: 1;
            resize: vertical;
        }
        .CodeMirror {
            flex-grow: 1;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            height: 100%;
            font-size: 14px;
        }
        #html-actions-container {
            display: none;
            flex-direction: row;
            gap: 10px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        .html-action-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .html-action-btn:hover {
            background-color: #e9ebee;
        }
        #runHtmlBtn {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        #runHtmlBtn:hover {
            background-color: #1868cd;
        }
        .drop-zone {
            position: relative;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            color: var(--secondary-text);
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            background-color: var(--surface-color);
            overflow: hidden;
        }
        .drop-zone.drag-over {
            background-color: #e8f0fe;
            border-color: var(--accent-color);
        }
        #fileInput {
            display: none;
        }
        #dropZone-text {
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        #upload-progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0;
            background-color: var(--accent-color);
            opacity: 0.3;
            transition: width 0.3s ease;
            z-index: 1;
        }
        #dropZone-text {
            position: relative;
            z-index: 2;
        }
        .drop-zone.uploading {
            border-color: var(--accent-color);
        }
        .list-filter-tabs {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .list-filter-tab {
            padding: 10px 15px;
            border: none;
            background: none;
            color: var(--secondary-text);
            font-weight: 600;
            cursor: pointer;
            position: relative;
            border-bottom: 3px solid transparent;
        }
        .list-filter-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }
        .list-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            flex-grow: 1;
            padding-right: 10px;
        }
        .list-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color .2s, box-shadow 0.2s, border-color 0.2s;
            background-color: var(--surface-color);
            box-shadow: 0 1px 2px var(--shadow-color);
            position: relative;
        }
        .list-item:hover {
            border-color: var(--accent-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        .item-icon {
            font-size: 24px;
            position: relative;
            flex-shrink: 0;
        }
        .item-icon .html-badge {
            position: absolute;
            bottom: -5px;
            right: -8px;
            background-color: #e02c4f;
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .item-details {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-grow: 1;
        }
        .item-title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        .item-preview {
            font-size: 14px;
            color: var(--secondary-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        .item-date {
            font-size: 12px;
            color: var(--secondary-text);
            position: absolute;
            top: 15px;
            right: 50px;
        }
        .delete-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--secondary-text);
            cursor: pointer;
            transition: color 0.2s;
            position: absolute;
            right: 15px;
            top: 15px;
            padding: 0;
            margin: 0;
        }
        .delete-btn:hover {
            color: #e02c4f;
        }
        .pin-indicator {
            position: absolute;
            bottom: -5px;
            right: -8px;
            font-size: 14px;
            background-color: var(--surface-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .list-item.pinned {
            background-color: #fdfaf0;
            border-left: 4px solid #f9c74f;
        }
        .sortable-ghost {
            opacity: 0.4;
            background: #c8ebfb;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: var(--surface-color);
            padding: 24px;
            border-radius: 12px;
            width: 95%;
            max-width: 900px;
            height: 90%;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }
        #modalTitle {
            font-size: 20px;
        }
        .modal-close-btn {
            font-size: 14px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--secondary-text);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
        }
        .modal-close-btn:hover {
            background-color: #e4e6e9;
        }
        #modalBody {
            flex-grow: 1;
            overflow: auto;
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            min-height: 0;
            text-align: center;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-shrink: 0;
        }
        .modal-btn {
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            color: var(--primary-text);
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        #modalActionBtn {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        #modalText {
            white-space: pre-wrap;
            word-break: break-all;
            height: 100%;
            text-align: left;
        }
        #modalImagePreview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: none;
        }
        #modalFileInfo {
            color: var(--secondary-text);
            text-align: left;
        }
        #htmlPreviewModal .modal-content {
            max-width: 100%;
            width: 100%;
            height: 100%;
            border-radius: 0;
            padding: 0;
        }
        #htmlPreviewModal .modal-header {
            padding: 16px;
            margin: 0;
            border-bottom: 1px solid var(--border-color);
        }
        #htmlPreviewModal .modal-body {
            padding: 0;
            background: #fff;
            flex-grow: 1;
        }
        #htmlPreviewModal .modal-body iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #confirmModal,
        #alertModal {
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        #confirmModal .modal-content,
        #alertModal .modal-content {
            max-width: 400px;
            padding: 24px;
            text-align: center;
            border-radius: 12px;
            height: auto;
        }
        #confirmModal h3,
        #alertModal h3 {
            margin-bottom: 20px;
        }
        #confirmModal .modal-actions,
        #alertModal .modal-actions {
            justify-content: center;
        }
        #alertModal .modal-actions {
            display: flex;
            justify-content: center;
        }
        #alertModal .modal-btn {
            background-color: var(--accent-color);
            color: white;
        }
        #secretModalBody {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-height: 0;
        }
        .secret-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 1px 2px var(--shadow-color);
            cursor: pointer;
        }
        .secret-list-item:hover {
            background-color: #e9ebee;
        }
        .secret-list-item-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .secret-delete-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--secondary-text);
            cursor: pointer;
            flex-shrink: 0;
            padding: 0 5px;
        }
        .secret-delete-btn:hover {
            color: #e02c4f;
        }
        #videoPlayerModal .modal-content {
            width: 95vw;
            max-width: 1400px;
            height: auto;
            padding: 12px;
            background-color: #1c1c1e;
        }
        #videoPlayerModal .modal-header {
            margin-bottom: 10px;
        }
        #videoPlayerModal #videoTitle {
            color: #fff;
            font-size: 16px;
        }
        #videoPlayerContainer {
            padding: 0;
            margin-bottom: 0;
            background-color: #000;
        }
        #videoPlayer {
            width: 100%;
            max-height: 85vh;
            display: block;
        }
        @media (max-width: 900px) {
            .input-column,
            .list-column {
                padding: 16px;
            }
            #main-tabs {
                padding: 8px 16px 0 16px;
            }
            .list-item {
                flex-direction: row;
            }
            .item-details {
                padding-right: 0;
            }
            .item-icon {
                margin-right: 15px;
            }
            .item-date {
                position: static;
                margin-top: 4px;
                font-size: 10px;
            }
            .item-title {
                font-size: 15px;
            }
            .item-preview {
                font-size: 13px;
            }
            .delete-btn {
                top: 50%;
                transform: translateY(-50%);
                font-size: 20px;
            }
            .modal-content {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
            #dropZone-text {
                padding: 0 10px;
            }
            /* âœ¨ ëª¨ë°”ì¼ì—ì„œ ì˜ìƒ í”Œë ˆì´ì–´ë¥¼ ì „ì²´ í™”ë©´ìœ¼ë¡œ í‘œì‹œ */
            #videoPlayerModal .modal-content {
                padding: 0;
                background-color: #000;
                justify-content: center;
            }
            #videoPlayerModal .modal-header {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                z-index: 1;
                background: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), transparent);
                border: none;
                padding-top: calc(env(safe-area-inset-top) + 10px);
                /* iPhone ë…¸ì¹˜ ë“± ìƒë‹¨ ì—¬ë°± í™•ë³´ */
            }
            #videoPlayerModal .modal-close-btn {
                color: white;
                background: transparent;
                border: none;
                font-weight: bold;
            }
            #videoPlayer {
                max-height: 100%;
                object-fit: contain;
                /* ì˜ìƒ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©° ê½‰ ì±„ìš°ê¸° */
            }
        }
        /* ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #loginBtn,
        #logoutBtn {
            padding: 4px 10px;
            /* íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 6px;
            font-size: 13px;
            /* í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
        }
        /* Google ë¡œê·¸ì¸ ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ */
        #loginBtn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            /* ì•„ì´ì½˜-í…ìŠ¤íŠ¸ ê°„ê²© ì¶•ì†Œ */
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }
        /* êµ¬ê¸€ ë¡œê³  ì•„ì´ì½˜ (SVG) */
        #loginBtn::before {
            content: '';
            display: inline-block;
            width: 15px;
            /* ì•„ì´ì½˜ í¬ê¸° ì¶•ì†Œ */
            height: 15px;
            /* ì•„ì´ì½˜ í¬ê¸° ì¶•ì†Œ */
            background-color: white;
            -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%23EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="%234285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="%23FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="%2334A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>') center/contain no-repeat;
            mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%23EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="%234285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="%23FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="%2334A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>') center/contain no-repeat;
        }
        .app-header {
            display: flex;
            align-items: center;
            padding: 0 24px;
            background-color: var(--sidebar-color);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        /* âœ¨ ë¼ì¸ êµ¬ê°„ ì„ íƒ ì‹œì‘ ì§€ì  í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ */
        .cm-start-line {
            background-color: rgba(66, 133, 244, 0.2);
        }
        /* âœ¨ ì—ë””í„° ì•¡ì…˜ ëª¨ë‹¬ (ë³µì‚¬/ë¶™ì—¬ë„£ê¸°) ìŠ¤íƒ€ì¼ */
        #editor-action-modal {
            display: none;
            position: absolute;
            z-index: 2000;
            background-color: rgba(40, 40, 40, 0.85);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 5px;
            gap: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        #editor-action-modal button {
            background: none;
            border: none;
            color: white;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
        }
        #editor-action-modal button:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }
        @media (max-width: 480px) {
            #auth-container {
                /* ìì‹ ìš”ì†Œë“¤ì´ ì¤„ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ ì„¤ì • */
                white-space: nowrap;
                /* ê³µê°„ì´ ë¶€ì¡±í•  ë•Œ ìš”ì†Œê°€ ì¤„ì–´ë“¤ë„ë¡ í—ˆìš© */
                flex-shrink: 1;
                min-width: 0;
            }
            #userInfo {
                font-size: 10px;
                /* ì´ë¦„ ê¸€ì”¨ í¬ê¸°ë¥¼ ì‚´ì§ ì¤„ì…ë‹ˆë‹¤. */
                /* ì´ë¦„ì´ ë„ˆë¬´ ê¸¸ ê²½ìš° ... ìœ¼ë¡œ í‘œì‹œë˜ë„ë¡ ì²˜ë¦¬ */
                /* max-width: 120px; ì‚­ì œ */
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                /* âœ¨ ì¤„ë°”ê¿ˆ ë°©ì§€ë¥¼ ìœ„í•´ ì¶”ê°€ */
                display: inline-block;
            }
            #logoutBtn {
                font-size: 10px;
                /* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ê¸€ì”¨ í¬ê¸°ë¥¼ ì‚´ì§ ì¤„ì…ë‹ˆë‹¤. */
                padding: 3px 8px;
                /* ë²„íŠ¼ í¬ê¸°ë¥¼ ì¡°ê¸ˆ ë” ì»´íŒ©íŠ¸í•˜ê²Œ ì¡°ì ˆ */
            }
        }

        /* âœ¨ [ì‹ ê·œ] ë”ë¸” íƒ­ ì œìŠ¤ì²˜ í”¼ë“œë°± ìŠ¤íƒ€ì¼ */
.video-gesture-overlay {
    position: absolute;
    top: 50%; transform: translateY(-50%);
    width: 100px; height: 100px;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    color: white; font-weight: bold; font-size: 1.2rem;
    opacity: 0; pointer-events: none;
    transition: opacity 0.2s;
    z-index: 20;
}
.gesture-left { left: 15%; }
.gesture-right { right: 15%; }
.ripple-effect { animation: ripple 0.4s ease-out; }
@keyframes ripple {
    0% { transform: translateY(-50%) scale(0.8); opacity: 0.8; }
    100% { transform: translateY(-50%) scale(1.5); opacity: 0; }
}

/* 1. ë‹«ê¸° ë²„íŠ¼ì´ ì ˆëŒ€ í™”ë©´ ë°–ìœ¼ë¡œ ë°€ë¦¬ì§€ ì•Šê²Œ ê³ ì • */
    #videoPlayerModal .modal-header {
        z-index: 9999 !important; /* ë¹„ë””ì˜¤ë³´ë‹¤ ë¬´ì¡°ê±´ ìœ„ì— */
        display: flex !important;
        width: 100% !important;
        padding-right: 10px !important;
        box-sizing: border-box !important;
    }

    /* 2. ì œëª©ì´ ë„ˆë¬´ ê¸¸ë©´ ... ìœ¼ë¡œ ì¤„ì—¬ë²„ë¦¬ê¸° */
    #videoPlayerModal #videoTitle {
        flex: 1; /* ë‚¨ì€ ê³µê°„ë§Œ ì°¨ì§€ */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis; /* ê¸€ì ë„˜ì¹˜ë©´ ... ì²˜ë¦¬ */
        margin-right: 10px;
        font-size: 14px; /* í´ë“œ ì¢ì€ í™”ë©´ ë°°ë ¤ */
    }

    /* 3. ë‹«ê¸° ë²„íŠ¼ ëˆˆì— í™• ë„ê²Œ ë§Œë“¤ê¸° */
    #videoPlayerModal .modal-close-btn {
        flex-shrink: 0; /* ì ˆëŒ€ ì°Œê·¸ëŸ¬ì§€ì§€ ì•ŠìŒ */
        background-color: rgba(255, 0, 0, 0.8) !important; /* ì˜ ë³´ì´ê²Œ ë¹¨ê°„ ë°˜íˆ¬ëª… ë°°ê²½ */
        color: white !important;
        border: 1px solid white !important;
        padding: 5px 10px !important;
        font-weight: bold;
    }

    /* âœ¨ [ì¶”ê°€] íƒ­ ë²„íŠ¼ ìˆ¨ê¸°ê¸° (HTML íƒ­ë§Œ ë‚¨ê¸°ê³  ì‹¶ìœ¼ë©´ nth-child ì¡°ì ˆ, ì—¬ê¸°ì„  ë‹¤ ìˆ¨ê¹€) */
    .tab-buttons {
        display: none !important; 
    }

    /* âœ¨ [ì¶”ê°€] í…ìŠ¤íŠ¸ ì…ë ¥ì°½ê³¼ íŒŒì¼ ë“œë¡­ì¡´ì„ í•­ìƒ í‘œì‹œ */
    #textInput-container,
    #fileInput-container {
        display: flex !important; /* ê°•ì œë¡œ ë³´ì´ê²Œ í•¨ */
        margin-bottom: 15px;
    }
    
    /* ë§í¬ ì…ë ¥ì°½ì€ ì´ì œ í•„ìš” ì—†ìŒ (í…ìŠ¤íŠ¸ ì°½ì´ë‘ í†µí•©) */
    #linkInput-container {
        display: none !important;
    }

    </style>
</head>
<body>
    <main class="app-container">
        <header class="app-header">
            <div id="main-tabs">
                <button class="main-tab-btn active" data-tab="input">ì—…ë¡œë“œ</button>
                <button class="main-tab-btn" data-tab="list">ì €ì¥ê³µê°„</button>
            </div>
            <div id="auth-container">
                <span id="userInfo" style="font-weight: 600; margin-right: 10px; display: none;"></span>
                <button id="loginBtn">Google ë¡œê·¸ì¸</button>
                <button id="logoutBtn" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>
        <section class="input-column">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="text">í…ìŠ¤íŠ¸</button>
                <button class="tab-btn" data-tab="link">ë§í¬</button>
                <button class="tab-btn" data-tab="file">íŒŒì¼</button>
                <button class="tab-btn" data-tab="html">HTML</button>
            </div>
            <input type="text" id="titleInput" class="input-field" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (í•„ìˆ˜)">
            <div id="html-actions-container">
                <button id="runHtmlBtn" class="html-action-btn">â–¶ì‹¤í–‰</button>
                <button id="searchBtn" class="html-action-btn">ğŸ”ê²€ìƒ‰</button>
                <button id="clearHtmlBtn" class="html-action-btn">ğŸ—‘ï¸ì‚­ì œ</button>
                <button id="themeToggleBtn" class="html-action-btn" style="flex: 0.5;">â˜€ï¸</button>
            </div>
            <div id="textInput-container">
                <textarea id="textInput" class="input-field" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
            </div>
            <div id="linkInput-container">
                <input type="url" id="linkInput" class="input-field"
                    placeholder="URL ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: https://google.com)">
            </div>
            <div id="fileInput-container">
                <div class="drop-zone" id="dropZone">
                    <div id="upload-progress-bar"></div>
                    <span id="dropZone-text">ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</span>
                    <input type="file" id="fileInput" multiple>
                </div>
            </div>
            <div id="htmlInput-container">
                <textarea id="htmlInput" placeholder="HTML ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>

            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; padding: 0 5px;">
    <input type="checkbox" id="vehicleCheckbox" style="width: 18px; height: 18px; cursor: pointer;">
    <label for="vehicleCheckbox" style="font-weight: 600; color: var(--secondary-text); cursor: pointer; font-size: 15px;">
        ì°¨ëŸ‰ê´€ë ¨ ì •ë³´
    </label>
</div>

            <button id="saveBtn" disabled>ì €ì¥í•˜ê¸°</button>
        </section>
        <section class="list-column">
         <div class="list-header">
    <h2>ë‚´ ì €ì¥ê³µê°„</h2>
    <div style="display: flex; gap: 5px;">
        <button id="migrateBtn" style="font-size: 13px; padding: 5px 10px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">
            ğŸš— ê¸°ì¡´ìë£Œ ì˜®ê¸°ê¸°
        </button>
        <button id="clearAllBtn">ëª¨ë‘ ì§€ìš°ê¸°</button>
    </div>
</div>
            <div class="list-filter-tabs">
                <button class="list-filter-tab active" data-filter="all">ì „ì²´</button>
                <button class="list-filter-tab" data-filter="document">ë¬¸ì„œ</button>
                <button class="list-filter-tab" data-filter="photo">ì‚¬ì§„</button>
                <button class="list-filter-tab" data-filter="vehicle">ì°¨ëŸ‰</button>
            </div>
            <div id="listContainer" class="list-container"></div>
        </section>
    </main>
    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="modal-close-btn">ë‹«ê¸°</button>
            </div>
            <div id="modalBody">
                <pre id="modalText"></pre>
                <iframe id="modalHtmlPreview"></iframe>
                <img id="modalImagePreview" />
                <div id="modalFileInfo"></div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" id="modalToggleViewBtn">ë¯¸ë¦¬ë³´ê¸°</button>
                <button class="modal-btn" id="modalDownloadHtmlBtn" style="display: none;">ë‹¤ìš´ë¡œë“œ</button>
                <button class="modal-btn" id="modalActionBtn"></button>
            </div>
        </div>
    </div>
    <div id="htmlPreviewModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close-btn">ë‹«ê¸°</button>
            </div>
            <div class="modal-body">
                <iframe id="htmlPreview" title="HTML Preview"></iframe>
            </div>
        </div>
    </div>
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content">
            <h3>ì •ë§ë¡œ ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
            <div class="modal-actions">
                <button id="confirmCancelBtn" class="modal-btn">ì·¨ì†Œ</button>
                <button id="confirmOkBtn" class="modal-btn"
                    style="background-color: #e02c4f; color: white; border-color: #e02c4f;">í™•ì¸</button>
            </div>
        </div>
    </div>
    <div id="alertModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="alertMessage"></h3>
            <div class="modal-actions">
                <button id="alertOkBtn" class="modal-btn">í™•ì¸</button>
            </div>
        </div>
    </div>
    <div id="secretModal" class="modal-overlay" style="align-items: flex-start; padding-top: 5vh;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="secretModalTitle">ğŸ”’ ë³´ì•ˆëª¨ë“œ</h3>
                <button class="modal-close-btn">ë‹«ê¸°</button>
            </div>
            <div id="secretModalBody">
                <p style="margin-bottom: 15px; font-weight: 600;">ë³´ì•ˆ ì—…ë¡œë“œ</p>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="file" id="secretUploadInput" accept="video/*,image/*,audio/*" class="input-field"
                        style="margin-bottom: 0;" multiple>
                    <button id="secretUploadBtn" class="html-action-btn"
                        style="flex-shrink: 0; width: 100px; margin: 0;">ì—…ë¡œë“œ</button>
                </div>
                <p id="secretUploadProgress" style="color: var(--secondary-text); height: 20px;"></p>
                <hr style="border: none; border-top: 1px solid var(--border-color); margin-bottom: 20px;">
                <div id="secretListContainer" class="list-container" style="margin-top: 0; padding-right: 0;"></div>
            </div>
        </div>
    </div>
    <div id="videoPlayerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="videoTitle">ë™ì˜ìƒ ì¬ìƒ</h3>
                <button class="modal-close-btn">ë‹«ê¸°</button>
            </div>
            <div id="videoPlayerContainer">
   <video id="videoPlayer" 
       controls 
       playsinline 
       preload="auto" 
       style="width: 100%; max-height: 85vh; background: #000;">
</video>
</div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <div id="editor-action-modal">
        <button id="editor-copy-btn">ë³µì‚¬</button>
        <button id="editor-paste-btn">ë¶™ì—¬ë„£ê¸°</button>
    </div>
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDrCteXGRfo4Gm95r0fIQxc_f8NgU42X80",
            authDomain: "youtubu-c770d.firebaseapp.com",
            projectId: "youtubu-c770d",
            storageBucket: "youtubu-c770d.firebasestorage.app",
            messagingSenderId: "727943010727",
            appId: "1:727943010727:web:44ce6a65c1887026523e82",
            measurementId: "G-82SBN9ZWZQ"
        };
        // Firebase Init
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();
        const itemsRef = database.ref('items');
        let secretRef;
        const ADMIN_UID = 'WZGm0K9WdaUl6J8hEjMYcHy5Hd42';
        // DOM Elements
        const modalDownloadHtmlBtn = document.getElementById('modalDownloadHtmlBtn');
        const titleInput = document.getElementById('titleInput');
        const textInputContainer = document.getElementById('textInput-container');
        const fileInputContainer = document.getElementById('fileInput-container');
        const htmlInputContainer = document.getElementById('htmlInput-container');
        const linkInputContainer = document.getElementById('linkInput-container');
        const textInput = document.getElementById('textInput');
        const linkInput = document.getElementById('linkInput');
        const fileInput = document.getElementById('fileInput');
        const htmlInput = document.getElementById('htmlInput');
        const htmlPreviewModal = document.getElementById('htmlPreviewModal');
        const htmlPreview = document.getElementById('htmlPreview');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const saveBtn = document.getElementById('saveBtn');
        const listContainer = document.getElementById('listContainer');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const modal = document.getElementById('modal');
        const modalClose = modal.querySelector('.modal-close-btn');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalText = document.getElementById('modalText');
        const modalFileInfo = document.getElementById('modalFileInfo');
        const modalHtmlPreview = document.getElementById('modalHtmlPreview');
        const modalImagePreview = document.getElementById('modalImagePreview');
        const modalToggleViewBtn = document.getElementById('modalToggleViewBtn');
        const modalActionBtn = document.getElementById('modalActionBtn');
        const dropZone = document.getElementById('dropZone');
        const dropZoneText = document.getElementById('dropZone-text');
        const progressBar = document.getElementById('upload-progress-bar');
        const confirmModal = document.getElementById('confirmModal');
        const confirmOkBtn = document.getElementById('confirmOkBtn');
        const confirmCancelBtn = document.getElementById('confirmCancelBtn');
        const alertModal = document.getElementById('alertModal');
        const alertMessage = document.getElementById('alertMessage');
        const alertOkBtn = document.getElementById('alertOkBtn');
        const listFilterTabs = document.querySelectorAll('.list-filter-tab');
        const htmlActionsContainer = document.getElementById('html-actions-container');
        const runHtmlBtn = document.getElementById('runHtmlBtn');
        const searchBtn = document.getElementById('searchBtn');
        const clearHtmlBtn = document.getElementById('clearHtmlBtn');
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const editorActionModal = document.getElementById('editor-action-modal');
        // State Variables

        // ==========================================
        // [ì„ì‹œ ê¸°ëŠ¥] ê¸°ì¡´ ìë£Œ ì°¨ëŸ‰ íƒ­ìœ¼ë¡œ ì´ì‚¬ì‹œí‚¤ê¸°
        // ==========================================
        const migrateBtn = document.getElementById('migrateBtn');
        
        migrateBtn.addEventListener('click', () => {
            const keywords = [
                'ì¹´ë‹ˆë°œ', 'ë‹¤ì´', 'DIY', 'diy', 'ë ˆì¼', 'ì— ë¹„ì–¸íŠ¸', 'ëª¨ë‹ˆí„°', 
                'ë¸Œë¼ì¼“', 'ìš”íŠ¸', 'ë°”ë‹¥', 'ëŒ€ë¦¬ì„', 'ì² íŒ', 'í‰íƒ„í™”', 
                'ë°°ì„ ', 'ë„ì–´', 'í•˜ë¸Œ', 'ì•„í¬ë¦´', 'ì„ ë°˜', 'íƒˆê±°', 'ì²œì¥', 'ìŠ¬ë¼ì´ë”©'
            ]; // âœ¨ ìŠ¤í¬ë¦°ìƒ·ì— ìˆëŠ” ì°¨ëŸ‰ ê´€ë ¨ ë‹¨ì–´ë“¤

            if(!confirm('ê¸°ì¡´ ìë£Œ ì¤‘ ì°¨ëŸ‰ ê´€ë ¨ ë‹¨ì–´ë‚˜ ë™ì˜ìƒì„ ì°¾ì•„ [ì°¨ëŸ‰] íƒ­ìœ¼ë¡œ ì´ë™ì‹œí‚¬ê¹Œìš”?')) return;

            itemsRef.once('value', snapshot => {
                const data = snapshot.val();
                if (!data) return showAlert('ì €ì¥ëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.');

                const updates = {};
                let count = 0;

                Object.keys(data).forEach(key => {
                    const item = data[key];
                    let shouldMove = false;

                    // 1. ì œëª©ì— í‚¤ì›Œë“œê°€ ìˆëŠ”ì§€ ê²€ì‚¬
                    if (item.title) {
                        for (const word of keywords) {
                            if (item.title.includes(word)) {
                                shouldMove = true;
                                break;
                            }
                        }
                    }

                    // 2. ë™ì˜ìƒ íŒŒì¼(.mp4)ì¸ì§€ ê²€ì‚¬ (ë™ì˜ìƒì€ ë‹¤ ì°¨ëŸ‰ì¸ê±° ê°™ì•„ì„œ)
                    if (item.fileName && item.fileName.toLowerCase().endsWith('.mp4')) {
                        shouldMove = true;
                    }

                    // 3. ì˜®ê²¨ì•¼ í•  ëŒ€ìƒì´ë©´ ì—…ë°ì´íŠ¸ ëª©ë¡ì— ì¶”ê°€
                    if (shouldMove) {
                        updates[`/${key}/category`] = 'vehicle';
                        count++;
                    }
                });

                if (count > 0) {
                    itemsRef.update(updates)
                        .then(() => {
                            showAlert(`ì„±ê³µ! ${count}ê°œì˜ ìë£Œë¥¼ ì°¨ëŸ‰ íƒ­ìœ¼ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤.`);
                            loadItemsFromFirebase(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        })
                        .catch(err => showAlert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message));
                } else {
                    showAlert('ì˜®ê¸¸ë§Œí•œ ìë£Œë¥¼ ëª» ì°¾ì•˜ìŠµë‹ˆë‹¤.');
                }
            });
        });


        let htmlEditor;
        let selectionInProgress = false;
        let startLine = null; // âœ¨ ì´ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”
        let currentTab = 'text';
        let savedItems = [];
        let currentItemInModal = null;
        let currentListFilter = 'all';
        let tapCounter = 0;
        let tapTimer = null;
        // Utility Functions
        function showAlert(message) {
            alertMessage.textContent = message;
            alertModal.style.display = 'flex';
            alertOkBtn.onclick = () => { alertModal.style.display = 'none'; };
        }
        function formatTimestamp(date) { return new Intl.DateTimeFormat('ko-KR', { year: '2-digit', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }).format(date); }
        function formatFileSize(bytes) { if (bytes === 0) return '0 Bytes'; const k = 1024; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + ['Bytes', 'KB', 'MB', 'GB'][i]; }
        function isHtml(text) { return text.trim().startsWith('<') && text.trim().endsWith('>'); }
        // âœ¨ ì•¡ì…˜ ëª¨ë‹¬ì„ ë³´ì—¬ì£¼ê³  ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ë“¤
        function showEditorActionModal(x, y) {
            const modal = editorActionModal;
            const editorWrapper = htmlEditor.getWrapperElement();
            const rect = editorWrapper.getBoundingClientRect();
            // ì—ë””í„° ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ê³„ì‚°
            let top = y - rect.top + 10;
            let left = x - rect.left;
            modal.style.display = 'flex'; // ë¨¼ì € í‘œì‹œí•´ì•¼ í¬ê¸° ê³„ì‚° ê°€ëŠ¥
            // ëª¨ë‹¬ì´ ì—ë””í„° ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ìœ„ì¹˜ ë³´ì •
            if (left + modal.offsetWidth > rect.width) {
                left = rect.width - modal.offsetWidth - 5;
            }
            if (top + modal.offsetHeight > rect.height) {
                top = y - rect.top - modal.offsetHeight - 10;
            }
            modal.style.top = `${top}px`;
            modal.style.left = `${left}px`;
            selectionInProgress = true;
        }
        function hideEditorActionModalAndReset() {
            if (!selectionInProgress) return;
            editorActionModal.style.display = 'none';
            if (startLine !== null) {
                htmlEditor.removeLineClass(startLine, 'background', 'cm-start-line');
            }
            startLine = null;
            selectionInProgress = false;
        }
       function getCategoryForItem(item) {
            // 1. DBì— ì´ë¯¸ 'vehicle'ì´ë¼ê³  ì €ì¥ëœ ë†ˆì€ ë¬´ì¡°ê±´ ì°¨ëŸ‰ íƒ­ìœ¼ë¡œ ë³´ëƒ„
            if (item.category === 'vehicle') return 'vehicle';

            // 2. ê·¸ ì™¸ ê¸°ì¡´ ë¡œì§
            if (item.type === 'text' || item.type === 'html' || item.type === 'link') return 'document';
            if (item.type === 'file') {
                if (item.isImage) return 'photo';
                return 'document';
            }
            return 'document';
        }

        function getIconForItem(item) {
            // âœ¨ ì°¨ëŸ‰ ì¹´í…Œê³ ë¦¬ë©´ ìë™ì°¨ ì•„ì´ì½˜ ë¦¬í„´
            if (item.category === 'vehicle') return 'ğŸš—';

            if (item.type === 'link') return 'ğŸ”—';
            const category = item.category || getCategoryForItem(item);
            if (category === 'photo') return 'ğŸ–¼ï¸';
            // if (category === 'music') return 'ğŸµ'; // ì‚­ì œë¨
            if (item.type === 'file') {
                const fileExtension = item.fileName.split('.').pop().toLowerCase();
                if (['mp4', 'mov', 'avi'].includes(fileExtension)) return 'ğŸ¬';
                if (['zip', 'rar', '7z'].includes(fileExtension)) return 'ğŸ“¦';
            }
            if (item.type === 'html' || (item.type === 'text' && isHtml(item.content))) return 'ğŸ’»';
            return 'ğŸ“„';
        }
        function downloadHtmlFile(item) {
            if (!item || !item.content) return;
            const blob = new Blob([item.content], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${item.title}.html`; // 'ì œëª©.html' í˜•ì‹ìœ¼ë¡œ íŒŒì¼ ì´ë¦„ ì„¤ì •
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        async function downloadFile(item) {
            if (!item || !item.fileUrl) return;
            const originalButtonText = modalActionBtn.textContent;
            modalActionBtn.disabled = true;
            modalActionBtn.textContent = 'ì¤€ë¹„ ì¤‘...';
            try {
                const response = await fetch(item.fileUrl);
                if (!response.ok) throw new Error('íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = blobUrl;
                const fileExtension = item.fileName.split('.').pop();
                link.download = `${item.title}.${fileExtension}`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(blobUrl);
            } catch (error) {
                console.error('Download failed:', error);
                showAlert('íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                modalActionBtn.disabled = false;
                modalActionBtn.textContent = originalButtonText;
            }
        }
       function playVideo(fileName, fileUrl) {
            const videoModal = document.getElementById('videoPlayerModal');
            const videoPlayer = document.getElementById('videoPlayer');
            const videoTitle = document.getElementById('videoTitle');
            const container = document.getElementById('videoPlayerContainer');

            videoTitle.textContent = fileName;
            videoPlayer.src = fileUrl;
            
            // âœ¨ [ì„¤ì •] ë°˜ë³µ ì¬ìƒ & ë°±ê·¸ë¼ìš´ë“œ ì¬ìƒ ì§€ì›
            videoPlayer.loop = true; 
            videoModal.style.display = 'flex';

            // âœ¨ [UI] ì œìŠ¤ì²˜ í”¼ë“œë°± ìš”ì†Œ ìƒì„± (ì—†ìœ¼ë©´ ë§Œë“¤ê¸°)
            if (!document.querySelector('.gesture-left')) {
                const leftOverlay = document.createElement('div');
                leftOverlay.className = 'video-gesture-overlay gesture-left';
                leftOverlay.innerHTML = 'âª 10s';
                
                const rightOverlay = document.createElement('div');
                rightOverlay.className = 'video-gesture-overlay gesture-right';
                rightOverlay.innerHTML = '10s â©';
                
                // containerëŠ” relativeì—¬ì•¼ í•¨
                container.style.position = 'relative';
                container.appendChild(leftOverlay);
                container.appendChild(rightOverlay);
            }

            // ë²„í¼ë§ ìƒíƒœ í‘œì‹œ
            videoPlayer.onwaiting = function() { videoTitle.textContent = "ë¡œë”© ì¤‘... ğŸ“¡"; };
            videoPlayer.onplaying = function() { videoTitle.textContent = fileName; };

            // âœ¨ [í•µì‹¬] ë”ë¸” íƒ­ ê°ì§€ ë¡œì§
            let lastTapTime = 0;
            let lastTapX = 0;

            const handleTap = (e) => {
                const currentTime = new Date().getTime();
                const tapGap = currentTime - lastTapTime;
                const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                const screenWidth = window.innerWidth;
                
                // 300ms ì´ë‚´ì— ë‘ ë²ˆ íƒ­í•˜ë©´ ì‹¤í–‰
                if (tapGap < 300 && tapGap > 0) {
                    e.preventDefault(); // ì¤Œ í™•ëŒ€ ë°©ì§€
                    
                    const leftIcon = document.querySelector('.gesture-left');
                    const rightIcon = document.querySelector('.gesture-right');

                    if (clientX < screenWidth * 0.4) {
                        // ì™¼ìª½ ì˜ì—­: -10ì´ˆ
                        videoPlayer.currentTime = Math.max(0, videoPlayer.currentTime - 10);
                        leftIcon.classList.add('ripple-effect');
                        leftIcon.style.opacity = '1';
                        setTimeout(() => { leftIcon.style.opacity = '0'; leftIcon.classList.remove('ripple-effect'); }, 400);
                    } else if (clientX > screenWidth * 0.6) {
                        // ì˜¤ë¥¸ìª½ ì˜ì—­: +10ì´ˆ
                        videoPlayer.currentTime = Math.min(videoPlayer.duration, videoPlayer.currentTime + 10);
                        rightIcon.classList.add('ripple-effect');
                        rightIcon.style.opacity = '1';
                        setTimeout(() => { rightIcon.style.opacity = '0'; rightIcon.classList.remove('ripple-effect'); }, 400);
                    } else {
                        // ê°€ìš´ë°: ì¬ìƒ/ì¼ì‹œì •ì§€ (ê¸°ë³¸ ë™ì‘)
                    }
                }
                lastTapTime = currentTime;
            };

            // í„°ì¹˜ ì´ë²¤íŠ¸ ë“±ë¡ (ëª¨ë°”ì¼)
            videoPlayer.removeEventListener('touchstart', handleTap); // ì¤‘ë³µ ë°©ì§€
            videoPlayer.addEventListener('touchstart', handleTap);

            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (PC/ë¸”ë£¨íˆ¬ìŠ¤ í‚¤ë³´ë“œ)
            document.onkeydown = function(e) {
                if(videoModal.style.display === 'flex') {
                    if(e.key === 'ArrowLeft') videoPlayer.currentTime -= 10;
                    if(e.key === 'ArrowRight') videoPlayer.currentTime += 10;
                    if(e.key === ' ') { 
                        e.preventDefault(); 
                        videoPlayer.paused ? videoPlayer.play() : videoPlayer.pause(); 
                    }
                }
            };

            const closeModalAndExitFullscreen = () => {
                videoPlayer.pause();
                videoPlayer.src = "";
                videoModal.style.display = 'none';
                if (document.fullscreenElement && document.exitFullscreen) {
                    document.exitFullscreen();
                }
                document.onkeydown = null; // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•´ì œ
            };

            videoModal.querySelector('.modal-close-btn').onclick = closeModalAndExitFullscreen;
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) closeModalAndExitFullscreen();
            }, { once: true });
        }
        
        function openSecretStash() {
            const storedPasswordHash = localStorage.getItem('secretStashPassword');
            if (!storedPasswordHash) {
                const newPassword = prompt("ìµœì´ˆ ì ‘ì†ì…ë‹ˆë‹¤. ë³´ì•ˆëª¨ë“œì—ì„œ ì‚¬ìš©í•  ìƒˆ ì•”í˜¸ë¥¼ ë§Œë“œì„¸ìš”:");
                if (newPassword) {
                    localStorage.setItem('secretStashPassword', CryptoJS.SHA256(newPassword).toString());
                    showAlert('ì•”í˜¸ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ë³´ì•ˆëª¨ë“œ ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                }
            } else {
                const password = prompt("ë³´ì•ˆëª¨ë“œ ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
                if (password) {
                    if (CryptoJS.SHA256(password).toString() === storedPasswordHash) {
                        const secretModal = document.getElementById('secretModal');
                        secretModal.style.display = 'flex';
                        secretRef.on('value', (snapshot) => {
                            const data = snapshot.val();
                            const items = [];
                            if (data) {
                                Object.keys(data).forEach(key => {
                                    items.push({ id: key, ...data[key] });
                                });
                            }
                            renderSecretList(items);
                        });
                        secretModal.querySelector('.modal-close-btn').onclick = () => {
                            secretModal.style.display = 'none';
                            secretRef.off();
                        };
                    } else {
                        showAlert("ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                    }
                }
            }
        }
        function renderSecretList(items) {
            const container = document.getElementById('secretListContainer');
            container.innerHTML = '<h4>ì €ì¥ëœ íŒŒì¼ ëª©ë¡</h4>';
            items.sort((a, b) => {
                if (a.isPinned && !b.isPinned) return -1;
                if (!a.isPinned && b.isPinned) return 1;
                const orderA = a.sortOrder !== undefined ? a.sortOrder : Infinity;
                const orderB = b.sortOrder !== undefined ? b.sortOrder : Infinity;
                if (orderA !== orderB) {
                    return orderA - orderB;
                }
                return b.timestamp - a.timestamp;
            });
            if (items.length === 0) {
                container.innerHTML += '<p style="color: var(--secondary-text); margin-top: 10px;">ì €ì¥ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'secret-list-item';
                if (item.isPinned) {
                    itemEl.classList.add('pinned');
                }
                itemEl.dataset.fileUrl = item.fileUrl;
                itemEl.dataset.fileName = item.fileName;
                itemEl.dataset.id = item.id;
                itemEl.innerHTML = `
                <div class="secret-item-icon">
                    ğŸ¬
                    ${item.isPinned ? '<div class="pin-indicator">â­</div>' : ''}
                </div>
                <span class="secret-list-item-title">${item.fileName}</span>
                <button class="secret-delete-btn" data-id="${item.id}" data-path="${item.storagePath}">&times;</button>
            `;
                container.appendChild(itemEl);
            });
        }
        function uploadSecretFile(file) {
        if (!file) return;

        const currentUser = auth.currentUser;
        if (!currentUser) {
            showAlert('ì—…ë¡œë“œë¥¼ ìœ„í•´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            return;
        }

        const progressEl = document.getElementById('secretUploadProgress');
        const uploadBtn = document.getElementById('secretUploadBtn');
        uploadBtn.disabled = true;

        const timestamp = Date.now();
        const storagePath = `users/${currentUser.uid}/secret_files/${timestamp}_${file.name}`;
        const fileRef = storage.ref(storagePath);

        const metadata = {
            contentType: file.type,
            cacheControl: 'public, max-age=31536000'
        };

        // ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ
        const uploadTask = fileRef.put(file, metadata);

        uploadTask.on('state_changed', 
            (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressEl.textContent = `ì—…ë¡œë“œ ì¤‘: ${Math.round(progress)}%`;
            },
            (error) => {
                showAlert('ë³´ì•ˆ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
                progressEl.textContent = '';
                uploadBtn.disabled = false;
            },
            () => {
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    const newItem = {
                        fileName: file.name,
                        fileUrl: downloadURL,
                        storagePath: storagePath,
                        timestamp: new Date().toISOString(),
                        isPinned: false,
                        sortOrder: Date.now()
                    };
                    
                    secretRef.push(newItem)
                        .then(() => {
                            progressEl.textContent = 'ì—…ë¡œë“œ ì™„ë£Œ!';
                            document.getElementById('secretUploadInput').value = '';
                            setTimeout(() => { progressEl.textContent = ''; }, 2000); 
                            uploadBtn.disabled = false; 
                        })
                        .catch(err => {
                            showAlert('DB ì €ì¥ ì‹¤íŒ¨: ' + err.message);
                            uploadBtn.disabled = false;
                        });
                });
            }
        );
    }

        function loadItemsFromFirebase() {
            itemsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                savedItems = [];
                if (data) {
                    savedItems = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key],
                        timestamp: new Date(data[key].timestamp)
                    }));
                }
                renderList();
            }, (error) => console.error("Firebase ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:", error));
        }
        function renderList() {
            listContainer.innerHTML = '';
            const sortedItems = savedItems.sort((a, b) => {
                if (a.isPinned && !b.isPinned) return -1;
                if (!a.isPinned && b.isPinned) return 1;
                const orderA = a.sortOrder !== undefined ? a.sortOrder : Infinity;
                const orderB = b.sortOrder !== undefined ? b.sortOrder : Infinity;
                if (orderA !== orderB) {
                    return orderA - orderB;
                }
                return b.timestamp - a.timestamp;
            });
            const filteredItems = sortedItems.filter(item => {
                if (currentListFilter === 'all') return true;
                return (item.category || getCategoryForItem(item)) === currentListFilter;
            });
            filteredItems.forEach(item => {
                const isHtmlItem = item.type === 'html' || (item.type === 'text' && isHtml(item.content));
                const icon = getIconForItem(item);
                const itemEl = document.createElement('div');
                itemEl.className = 'list-item';
                if (item.isPinned) {
                    itemEl.classList.add('pinned');
                }
                itemEl.dataset.id = item.id;
                let itemContentHTML = '';
                if (item.type === 'text' || item.type === 'html' || item.type === 'link') {
                    const preview = (item.content.substring(0, 40).replace(/\n/g, ' ') + (item.content.length > 40 ? '...' : ''));
                    itemContentHTML = `<div class="item-details"><div class="item-title">${item.title}</div><div class="item-preview">${preview}</div></div>`;
                } else if (item.type === 'file') {
                    const fileNamePreview = item.fileName.length > 20 ? '...' + item.fileName.slice(-17) : item.fileName;
                    itemContentHTML = `<div class="item-details"><div class="item-title">${item.title}</div><div class="item-preview">${fileNamePreview} (${formatFileSize(item.fileSize)})</div></div>`;
                }
                itemEl.innerHTML = `
                <div class="item-icon">
                    ${icon}
                    ${isHtmlItem ? '<span class="html-badge">&lt;/&gt;</span>' : ''}
                    ${item.isPinned ? '<div class="pin-indicator">â­</div>' : ''}
                </div>
                ${itemContentHTML}
                <div class="item-date">${formatTimestamp(item.timestamp)}</div>
                <button class="delete-btn">&times;</button>
            `;
                listContainer.appendChild(itemEl);
            });
        }
        function openModal(id) {
            currentItemInModal = savedItems.find(i => i.id === id);
            if (!currentItemInModal) return;
            modalTitle.textContent = currentItemInModal.title;
            modalText.style.display = 'none';
            modalHtmlPreview.style.display = 'none';
            modalImagePreview.style.display = 'none';
            modalFileInfo.style.display = 'none';
            modalToggleViewBtn.style.display = 'none';
            modalDownloadHtmlBtn.style.display = 'none';
            modalActionBtn.style.display = 'inline-block';
            if (currentItemInModal.type === 'text' || currentItemInModal.type === 'html') {
                modalToggleViewBtn.style.display = 'inline-block';
                modalDownloadHtmlBtn.style.display = 'inline-block';
                modalDownloadHtmlBtn.onclick = () => downloadHtmlFile(currentItemInModal);
                modalActionBtn.textContent = 'ì „ì²´ ë³µì‚¬';
                modalActionBtn.onclick = () => copyText(currentItemInModal.content);
                showContentView();
            } else if (currentItemInModal.type === 'file') {
                modalToggleViewBtn.style.display = 'none';
                modalActionBtn.textContent = 'ë‹¤ìš´ë¡œë“œ';
                modalActionBtn.onclick = () => downloadFile(currentItemInModal);
                if (currentItemInModal.isImage) {
                    modalImagePreview.src = currentItemInModal.fileUrl;
                    modalImagePreview.style.display = 'block';
                } else {
                    modalFileInfo.innerHTML = `<div style="font-size: 5rem; line-height: 1;">${getIconForItem(currentItemInModal)}</div><p style="font-weight: 600; margin-top: 1rem;">${currentItemInModal.fileName}</p><p style="color: var(--secondary-text);">${formatFileSize(currentItemInModal.fileSize)}</p>`;
                    modalFileInfo.style.display = 'block';
                }
            }
            modal.style.display = 'flex';
            history.pushState({ modalOpen: true }, '', '#modal');
        }
        function closeModal() {
            modal.style.display = 'none';
            modalHtmlPreview.srcdoc = '';
            modalImagePreview.src = '';
            currentItemInModal = null;
            if (window.location.hash === '#modal') { history.back(); }
        }
        function showContentView() {
            if (!currentItemInModal || (currentItemInModal.type !== 'text' && currentItemInModal.type !== 'html')) return;
            modalText.textContent = currentItemInModal.content;
            modalText.style.display = 'block';
            modalHtmlPreview.style.display = 'none';
            modalToggleViewBtn.textContent = 'ë¯¸ë¦¬ë³´ê¸°';
        }
        function showPreviewView() {
            if (!currentItemInModal || (currentItemInModal.type !== 'text' && currentItemInModal.type !== 'html')) return;
            modalText.style.display = 'none';
            modalHtmlPreview.style.display = 'block';
            modalHtmlPreview.srcdoc = currentItemInModal.content;
            modalToggleViewBtn.textContent = 'ë‚´ìš© ë³´ê¸°';
        }
        function closeHtmlPreviewModal() { htmlPreviewModal.style.display = 'none'; }
        function showConfirmModal(message, onConfirm) {
            confirmModal.querySelector('h3').textContent = message;
            confirmModal.style.display = 'flex';
            const handleConfirm = () => { onConfirm(); closeModalAndListeners(); };
            const handleCancel = () => { closeModalAndListeners(); };
            function closeModalAndListeners() {
                confirmModal.style.display = 'none';
                confirmOkBtn.removeEventListener('click', handleConfirm);
                confirmCancelBtn.removeEventListener('click', handleCancel);
            }
            confirmOkBtn.addEventListener('click', handleConfirm);
            confirmCancelBtn.addEventListener('click', handleCancel);
        }
        function copyText(text) {
            const originalButtonText = 'ì „ì²´ ë³µì‚¬';
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    modalActionBtn.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                    setTimeout(() => { modalActionBtn.textContent = originalButtonText; }, 1500);
                }).catch(err => {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨, ëŒ€ì²´ ë°©ë²• ì‹œë„:', err);
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
            function fallbackCopy(textToCopy) {
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                textArea.style.position = "fixed";
                textArea.style.top = 0;
                textArea.style.left = 0;
                textArea.style.opacity = 0;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    modalActionBtn.textContent = successful ? 'ë³µì‚¬ ì™„ë£Œ!' : 'ë³µì‚¬ ì‹¤íŒ¨';
                } catch (err) {
                    modalActionBtn.textContent = 'ë³µì‚¬ ì‹¤íŒ¨';
                    console.error('ëŒ€ì²´ ë³µì‚¬ ë°©ë²• ì˜¤ë¥˜:', err);
                }
                document.body.removeChild(textArea);
                setTimeout(() => { modalActionBtn.textContent = originalButtonText; }, 1500);
            }
        }
        function switchTab(tab) {
            currentTab = tab;
            tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tab));
            if (tab === 'html') {
                document.body.classList.add('html-mode-mobile');
            } else {
                document.body.classList.remove('html-mode-mobile');
            }
            textInputContainer.style.display = 'none';
            linkInputContainer.style.display = 'none';
            fileInputContainer.style.display = 'none';
            htmlInputContainer.style.display = 'none';
            titleInput.style.display = 'none';
            htmlActionsContainer.style.display = 'none';
            if (tab === 'text' || tab === 'link' || tab === 'file') {
                titleInput.style.display = 'block';
                if (tab === 'text') textInputContainer.style.display = 'flex';
                if (tab === 'link') linkInputContainer.style.display = 'flex';
                if (tab === 'file') fileInputContainer.style.display = 'flex';
            } else if (tab === 'html') {
                htmlInputContainer.style.display = 'flex';
                htmlActionsContainer.style.display = 'flex';
                setTimeout(() => htmlEditor.refresh(), 1);
            }
            updateSaveButtonState();
        }
        function updateSaveButtonState() {
            const title = titleInput.value.trim();
            const content = textInput.value.trim();
            const hasFile = fileInput.files.length > 0;

            // ì œëª©ì´ ìˆê³ , (ë‚´ìš©ì´ ìˆê±°ë‚˜ OR íŒŒì¼ì´ ìˆìœ¼ë©´) -> ë²„íŠ¼ í™œì„±í™”
            if (title && (content || hasFile)) {
                saveBtn.disabled = false;
            } else {
                saveBtn.disabled = true;
            }
        }
       // ==========================================
        // [ìŠ¤ë§ˆíŠ¸ ì—…ë¡œë“œ] ì…ë ¥ ë‚´ìš©ì— ë”°ë¼ ìë™ ë¶„ë¥˜ ì €ì¥
        // ==========================================
        function handleSave() {
            const title = titleInput.value.trim();
            const content = textInput.value.trim();
            const files = fileInput.files;
            // âœ¨ 1. ì²´í¬ë°•ìŠ¤ ê°’ ê°€ì ¸ì˜¤ê¸°
            const isVehicle = document.getElementById('vehicleCheckbox').checked;

            const currentUser = auth.currentUser;
            if (!currentUser) { showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }
            if (!title) { showAlert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            const resetForm = () => {
                titleInput.value = ''; textInput.value = ''; fileInput.value = '';
                document.getElementById('vehicleCheckbox').checked = false; 
                dropZoneText.textContent = 'ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­';
                updateSaveButtonState();
            };

            // [CASE 1] íŒŒì¼ ì—…ë¡œë“œ
            if (files.length > 0) {
                for (const file of files) {
                    ((fileToProcess) => {
                        const isImage = fileToProcess.type.startsWith('image/');
                        const handleUpload = (fileBlob) => {
                            const fileTitle = files.length > 1 ? `${title} (${fileToProcess.name})` : title;
                            const isLastFile = fileToProcess === files[files.length - 1];
                            
                            // âœ¨âœ¨âœ¨ [ì—¬ê¸°ê°€ í•µì‹¬ì…ë‹ˆë‹¤] âœ¨âœ¨âœ¨
                            // ë§¨ ë’¤ì— isVehicle ë³€ìˆ˜ë¥¼ ê´„í˜¸ ì•ˆì— ê¼­ ë„£ì–´ì•¼ í•©ë‹ˆë‹¤!
                            uploadFileToFirebase(fileBlob, fileTitle, fileToProcess.name, fileToProcess.type, isLastFile ? resetForm : () => { }, isVehicle);
                        };

                        if (isImage) {
                            const reader = new FileReader();
                            reader.onload = e => {
                                const img = new Image();
                                img.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const MAX_WIDTH = 1024, MAX_HEIGHT = 768;
                                    let { width, height } = img;
                                    if (width > height) { if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } }
                                    else { if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; } }
                                    canvas.width = width; canvas.height = height;
                                    const ctx = canvas.getContext('2d');
                                    ctx.drawImage(img, 0, 0, width, height);
                                    canvas.toBlob(blob => handleUpload(blob || fileToProcess), fileToProcess.type, 0.75);
                                };
                                img.src = e.target.result;
                            };
                            reader.readAsDataURL(fileToProcess);
                        } else {
                            handleUpload(fileToProcess);
                        }
                    })(file);
                }
                return;
            }

            // [CASE 2, 3] í…ìŠ¤íŠ¸/ë§í¬ ì—…ë¡œë“œ
            let newItem = {
                title: title,
                content: content,
                timestamp: new Date().toISOString(),
                isPinned: false,
                sortOrder: Date.now()
            };

            // âœ¨ ì°¨ëŸ‰ ì²´í¬ë˜ë©´ ë¬´ì¡°ê±´ vehicle
            if (isVehicle) {
                newItem.category = 'vehicle';
                newItem.type = /^(http|https):\/\/[^ "]+$/.test(content) ? 'link' : 'text';
            } else {
                // ì²´í¬ ì•ˆ ë˜ë©´ ìë™ ë¶„ë¥˜
                const urlRegex = /^(http|https):\/\/[^ "]+$/;
                if (urlRegex.test(content)) {
                    newItem.type = 'link';
                    newItem.category = 'document';
                } else if (content) {
                    newItem.type = 'text';
                    newItem.category = 'document';
                } else {
                    showAlert('ë‚´ìš©ì´ë‚˜ íŒŒì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            itemsRef.push(newItem).then(resetForm).catch(err => showAlert('ì €ì¥ ì‹¤íŒ¨: ' + err.message));
        }
       // âœ¨ ë§¨ ë’¤ì— isVehicle íŒŒë¼ë¯¸í„° ì¶”ê°€ë¨
        // âœ¨ ë§¨ ë’¤ì— isVehicle íŒŒë¼ë¯¸í„°ê°€ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!
        // âœ¨ ë§¨ ë’¤ì— isVehicle ì¶”ê°€ í™•ì¸!
        function uploadFileToFirebase(fileToUpload, title, originalFileName, fileType, resetFormCallback, isVehicle) {
            const currentUser = auth.currentUser;
            if (!currentUser) { showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

            const storagePath = `files/${title}_${Date.now()}_${originalFileName}`;
            const fileRef = storage.ref(storagePath);
            const uploadTask = fileRef.put(fileToUpload);

            dropZone.classList.add('uploading');
            progressBar.style.width = '0%';

            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    dropZoneText.textContent = `ì—…ë¡œë“œ ì¤‘: ${Math.round(progress)}%`;
                    progressBar.style.width = `${progress}%`;
                },
                (error) => {
                    showAlert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
                    dropZone.classList.remove('uploading');
                },
                () => {
                    progressBar.style.width = '100%';
                    dropZone.classList.remove('uploading');
                    dropZoneText.textContent = 'ì™„ë£Œ!';
                    
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        const newItem = {
                            type: 'file',
                            title: title,
                            fileName: originalFileName,
                            fileSize: fileToUpload.size,
                            isImage: fileType.startsWith('image/'),
                            fileUrl: downloadURL,
                            storagePath: storagePath,
                            timestamp: new Date().toISOString(),
                            isPinned: false,
                            sortOrder: Date.now(),
                            // âœ¨âœ¨âœ¨ [ì—¬ê¸°ê°€ í•µì‹¬] isVehicleì´ trueë©´ ë¬´ì¡°ê±´ 'vehicle'ë¡œ ì €ì¥ âœ¨âœ¨âœ¨
                            category: isVehicle ? 'vehicle' : getCategoryForItem({ type: 'file', isImage: fileType.startsWith('image/'), fileName: originalFileName })
                        };
                        
                        itemsRef.push(newItem).then(() => {
                            setTimeout(() => { progressBar.style.width = '0%'; resetFormCallback(); }, 500);
                        });
                    });
                }
            );
        }
        function addEventListeners() {
            tabButtons.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.tab)));
            saveBtn.addEventListener('click', handleSave);
            runHtmlBtn.addEventListener('click', () => {
                const code = htmlEditor.getValue();
                if (!code.trim()) { showAlert("ì‹¤í–‰í•  HTML ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }
                htmlPreview.srcdoc = code;
                htmlPreviewModal.style.display = 'flex';
            });
            searchBtn.addEventListener('click', () => { htmlEditor.execCommand("findPersistent"); });
            htmlPreviewModal.querySelector('.modal-close-btn').addEventListener('click', closeHtmlPreviewModal);
            listContainer.addEventListener('click', (e) => {
                const listItem = e.target.closest('.list-item');
                if (!listItem) return;
                const id = listItem.dataset.id;
                const item = savedItems.find(i => i.id === id);
                if (!item) return;
                if (e.target.closest('.item-icon')) {
                    const newPinnedState = !item.isPinned;
                    itemsRef.child(id).update({ isPinned: newPinnedState })
                        .catch(err => showAlert('í•€ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + err.message));
                    return;
                }
                if (e.target.classList.contains('delete-btn')) {
                    showConfirmModal('ì •ë§ë¡œ ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => {
                        itemsRef.child(id).remove().then(() => {
                            if (item.type === 'file' && item.storagePath) {
                                storage.ref(item.storagePath).delete().catch(err => console.warn('Storage íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨:', err));
                            }
                        }).catch(err => showAlert('ì‚­ì œ ì‹¤íŒ¨: ' + err.message));
                    });
                    return;
                }
                if (item.type === 'link') {
                    window.open(item.content, '_blank');
                } else {
                    openModal(id);
                }
            });
            clearAllBtn.addEventListener('click', () => { showConfirmModal('ëª¨ë“  í•­ëª©ì´ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => { itemsRef.remove().catch(err => showAlert('ëª¨ë‘ ì§€ìš°ê¸° ì‹¤íŒ¨: ' + err.message)); }); });
            [titleInput, textInput, linkInput].forEach(el => el.addEventListener('input', updateSaveButtonState));
            fileInput.addEventListener('change', () => { updateSaveButtonState(); dropZoneText.textContent = fileInput.files.length > 0 ? fileInput.files[0].name : 'ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­'; });
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
            dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag-over'); if (e.dataTransfer.files.length > 0) { fileInput.files = e.dataTransfer.files; dropZoneText.textContent = fileInput.files[0].name; } updateSaveButtonState(); });
            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
            modalToggleViewBtn.addEventListener('click', () => { if (modalToggleViewBtn.textContent === 'ë¯¸ë¦¬ë³´ê¸°') showPreviewView(); else showContentView(); });
            window.addEventListener('popstate', (event) => { if (modal.style.display === 'flex') { closeModal(); } });
            listFilterTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    listFilterTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentListFilter = tab.dataset.filter;
                    renderList();
                });
            });
            const secretTrigger = document.querySelector('.list-header h2');
            if (secretTrigger) {
                secretTrigger.style.cursor = 'pointer';
                secretTrigger.addEventListener('click', () => {
                    tapCounter++;
                    clearTimeout(tapTimer);
                    if (tapCounter === 10) {
                        tapCounter = 0;
                        const currentUser = auth.currentUser;
                        if (currentUser && currentUser.uid === ADMIN_UID) {
                            openSecretStash();
                        }
                    } else {
                        tapTimer = setTimeout(() => {
                            tapCounter = 0;
                        }, 2000);
                    }
                });
            }
            const secretUploadInput = document.getElementById('secretUploadInput');
            const secretUploadBtn = document.getElementById('secretUploadBtn');
            secretUploadBtn.addEventListener('click', () => {
                const files = secretUploadInput.files;
                if (files.length > 0) {
                    for (const file of files) {
                        uploadSecretFile(file);
                    }
                } else {
                    showAlert('ì—…ë¡œë“œí•  íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                }
            });
            const secretListContainer = document.getElementById('secretListContainer');
            secretListContainer.addEventListener('click', (e) => {
                const deleteBtn = e.target.closest('.secret-delete-btn');
                const listItem = e.target.closest('.secret-list-item');
                const icon = e.target.closest('.secret-item-icon');
                if (icon) {
                    const id = listItem.dataset.id;
                    secretRef.child(id).once('value', snapshot => {
                        const currentItem = snapshot.val();
                        const newPinnedState = !(currentItem.isPinned || false);
                        secretRef.child(id).update({ isPinned: newPinnedState });
                    });
                } else if (deleteBtn) {
                    const id = deleteBtn.dataset.id;
                    const path = deleteBtn.dataset.path;
                    showConfirmModal('ì´ íŒŒì¼ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => {
                        secretRef.child(id).remove().then(() => {
                            if (path && path !== "undefined") {
                                storage.ref(path).delete().then(() => {
                                    showAlert('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                }).catch((error) => {
                                    console.error('ìŠ¤í† ë¦¬ì§€ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨:', error);
                                    showAlert(`íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì—ëŸ¬: ${error.code}`);
                                });
                            } else {
                                showAlert('ëª©ë¡ì—ì„œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                            }
                        }).catch(err => showAlert('DB ì •ë³´ ì‚­ì œ ì‹¤íŒ¨: ' + err.message));
                    });
                } else if (listItem) {
                    playVideo(listItem.dataset.fileName, listItem.dataset.fileUrl);
                }
            });
            new Sortable(secretListContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                delay: 1000,
                delayOnTouchOnly: true,
                onEnd: function (evt) {
                    const items = secretListContainer.querySelectorAll('.secret-list-item');
                    const updates = {};
                    items.forEach((item, index) => {
                        const itemId = item.dataset.id;
                        if (itemId) {
                            updates[`/${itemId}/sortOrder`] = index;
                        }
                    });
                    if (Object.keys(updates).length > 0) {
                        secretRef.update(updates).catch(err => {
                            showAlert('ìˆœì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + err.message);
                        });
                    }
                }
            });
            clearHtmlBtn.addEventListener('click', () => {
                if (htmlEditor) {
                    htmlEditor.setValue('');
                }
            });
            themeToggleBtn.addEventListener('click', () => {
                const currentTheme = htmlEditor.getOption('theme');
                const newTheme = currentTheme === 'material-darker' ? 'eclipse' : 'material-darker';
                htmlEditor.setOption('theme', newTheme);
                localStorage.setItem('editorTheme', newTheme);
                themeToggleBtn.innerHTML = newTheme === 'material-darker' ? 'â˜€ï¸' : 'ğŸŒ™';
            });
            document.getElementById('loginBtn').addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider).catch(error => {
                    console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨:", error);
                    showAlert("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
            });
            document.getElementById('logoutBtn').addEventListener('click', () => {
                auth.signOut();
            });
            // âœ¨ ì—ë””í„° ì•¡ì…˜ ëª¨ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('editor-copy-btn').addEventListener('click', () => {
                const selectedText = htmlEditor.getSelection();
                if (selectedText) {
                    navigator.clipboard.writeText(selectedText).then(() => {
                        showAlert('ì„ íƒí•œ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        hideEditorActionModalAndReset();
                    }).catch(err => {
                        showAlert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        hideEditorActionModalAndReset();
                    });
                } else {
                    hideEditorActionModalAndReset();
                }
            });
            document.getElementById('editor-paste-btn').addEventListener('click', () => {
                navigator.clipboard.readText().then(text => {
                    if (text) {
                        htmlEditor.replaceSelection(text);
                    } else {
                        showAlert('í´ë¦½ë³´ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                    }
                }).catch(err => {
                    console.error('Paste failed:', err);
                    showAlert('ë¶™ì—¬ë„£ê¸° ê¶Œí•œì´ ì—†ê±°ë‚˜ í´ë¦½ë³´ë“œê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                }).finally(() => {
                    hideEditorActionModalAndReset();
                });
            });
            // âœ¨ ì—ë””í„°ì˜ ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
            htmlEditor.on('mousedown', function (cm, event) {
                if (selectionInProgress && !editorActionModal.contains(event.target)) {
                    hideEditorActionModalAndReset();
                }
            });
            const mainTabBtns = document.querySelectorAll('.main-tab-btn');
            mainTabBtns.forEach(btn => {
                btn.addEventListener('click', () => switchMainTab(btn.dataset.tab));
            });
        }
        function switchMainTab(tabToShow) {
            const inputColumn = document.querySelector('.input-column');
            const listColumn = document.querySelector('.list-column');
            const mainTabBtns = document.querySelectorAll('.main-tab-btn');
            if (tabToShow === 'input') {
                inputColumn.style.display = 'flex';
                listColumn.style.display = 'none';
            } else {
                inputColumn.style.display = 'none';
                listColumn.style.display = 'flex';
            }
            mainTabBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabToShow);
            });
        }
        function initializeApp() {
            auth.onAuthStateChanged(user => {
                const loginBtn = document.getElementById('loginBtn');
                const logoutBtn = document.getElementById('logoutBtn');
                const userInfo = document.getElementById('userInfo');
                if (user) {
                    // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•œ ê²½ìš°
                    userInfo.textContent = `${user.displayName}ë‹˜`;
                    userInfo.style.display = 'inline';
                    loginBtn.style.display = 'none';
                    logoutBtn.style.display = 'inline';
                    secretRef = database.ref(`users/${user.uid}/secret_items`);
                } else {
                    // ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒí•œ ê²½ìš°
                    userInfo.style.display = 'none';
                    loginBtn.style.display = 'inline';
                    logoutBtn.style.display = 'none';
                    secretRef = null;
                }
                loadItemsFromFirebase();
            });
            new Sortable(listContainer, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                delay: 1000,
                delayOnTouchOnly: true,
                onEnd: function (evt) {
                    const items = listContainer.querySelectorAll('.list-item');
                    const updates = {};
                    items.forEach((item, index) => {
                        const itemId = item.dataset.id;
                        updates[`/${itemId}/sortOrder`] = index;
                    });
                    itemsRef.update(updates).catch(err => {
                        showAlert('ìˆœì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + err.message);
                    });
                }
            });
            handleSharedData();
            const savedTheme = localStorage.getItem('editorTheme') || 'material-darker';
            htmlEditor = CodeMirror.fromTextArea(htmlInput, {
                lineNumbers: true,
                mode: 'htmlmixed',
                theme: savedTheme,
                lineWrapping: true,
                extraKeys: {
                    "Ctrl-F": "findPersistent", "Cmd-F": "findPersistent",
                    "Ctrl-G": "findNext", "Cmd-G": "findNext",
                    "Shift-Ctrl-G": "findPrev", "Shift-Cmd-G": "findPrev"
                }
            });
            themeToggleBtn.innerHTML = savedTheme === 'material-darker' ? 'â˜€ï¸' : 'ğŸŒ™';
            htmlEditor.on('change', updateSaveButtonState);
            htmlEditor.on('gutterClick', function (cm, line, gutter, clickEvent) {
                if (selectionInProgress) {
                    hideEditorActionModalAndReset();
                    return;
                }
                if (startLine === null) {
                    startLine = line;
                    cm.addLineClass(line, 'background', 'cm-start-line');
                } else {
                    const endLine = line;
                    if (startLine === endLine) {
                        cm.removeLineClass(startLine, 'background', 'cm-start-line');
                        startLine = null;
                        return;
                    }
                    const from = Math.min(startLine, endLine);
                    const to = Math.max(startLine, endLine);
                    // âœ¨ ë³µì‚¬ ëŒ€ì‹  í…ìŠ¤íŠ¸ ì„ íƒ
                    cm.setSelection(
                        { line: from, ch: 0 },
                        { line: to, ch: cm.getLine(to).length }
                    );
                    // âœ¨ ì•¡ì…˜ ëª¨ë‹¬ í‘œì‹œ
                    showEditorActionModal(clickEvent.clientX, clickEvent.clientY);
                }
            });
            addEventListeners();
            // âœ¨ 'ë‚´ë ¤ì„œ ìƒˆë¡œê³ ì¹¨' ê¸°ëŠ¥ ì´ˆê¸°í™”
            PullToRefresh.init({
                mainElement: '.list-column',
                triggerElement: '.list-column',
                onRefresh: function (done) {
                    loadItemsFromFirebase();
                    done();
                }
            });
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('service-worker.js')
                        .then(reg => console.log('SW registered.', reg))
                        .catch(err => console.error('SW registration failed: ', err));
                });
            }
        }
        // ==========================================
        // [ê³µìœ  íƒ€ê²Ÿ] ì™¸ë¶€ ì•±ì—ì„œ ê³µìœ ë°›ìœ¼ë©´ ìë™ ì €ì¥
        // ==========================================
        function handleSharedData() {
            const urlParams = new URLSearchParams(window.location.search);
            const sharedTitle = urlParams.get('title');
            const sharedText = urlParams.get('text'); // ë„¤ì´ë²„ ì¹´í˜ëŠ” ì—¬ê¸°ì— ë§í¬ê°€ ì„ì—¬ ì˜´
            const sharedUrl = urlParams.get('url');

            // ê³µìœ ëœ ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ ì‹¤í–‰
            if (sharedTitle || sharedText || sharedUrl) {
                console.log("ê³µìœ  ë°ì´í„° ê°ì§€:", sharedTitle, sharedText, sharedUrl);

                // 1. ë°ì´í„° ì •ì œ (ë„¤ì´ë²„ ì¹´í˜ ë“±ì€ ì œëª©/ë‚´ìš©ì´ ì„ì—¬ì„œ ì˜´)
                let finalTitle = sharedTitle || '';
                let finalContent = sharedText || '';
                
                // URLì´ text í•„ë“œì— ì„ì—¬ìˆëŠ” ê²½ìš° ì¶”ì¶œ (ë§í¬ íƒ­ìœ¼ë¡œ ë³´ë‚´ê¸° ìœ„í•¨)
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                const foundUrl = sharedText ? sharedText.match(urlRegex) : null;
                
                if (sharedUrl) {
                    finalContent = sharedUrl;
                    switchTab('link'); // ë§í¬ íƒ­ìœ¼ë¡œ ì „í™˜
                } else if (foundUrl) {
                    finalContent = foundUrl[0]; // í…ìŠ¤íŠ¸ì—ì„œ ë§í¬ë§Œ ë½‘ìŒ
                    // ì œëª©ì´ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ì˜ ì•ë¶€ë¶„ì„ ì œëª©ìœ¼ë¡œ ì”€
                    if (!finalTitle) finalTitle = sharedText.replace(finalContent, '').trim().substring(0, 30);
                    switchTab('link');
                } else {
                    switchTab('text');
                }

                // 2. ì…ë ¥ì°½ì— ê°’ ì±„ìš°ê¸°
                titleInput.value = finalTitle || 'ê³µìœ ëœ ìë£Œ';
                if (currentTab === 'link') linkInput.value = finalContent;
                else textInput.value = finalContent;

                // 3. [í•µì‹¬] ì°¨ëŸ‰ ê´€ë ¨ ë‚´ìš©ì¸ì§€ ìë™ íƒì§€ (ì•„ê¹Œ ë§Œë“  í‚¤ì›Œë“œ í™œìš©)
                const vehicleKeywords = [
                    'ì¹´ë‹ˆë°œ', 'ë‹¤ì´', 'DIY', 'diy', 'ë ˆì¼', 'ì— ë¹„ì–¸íŠ¸', 'ëª¨ë‹ˆí„°', 
                    'ë¸Œë¼ì¼“', 'ìš”íŠ¸', 'ë°”ë‹¥', 'ëŒ€ë¦¬ì„', 'ì² íŒ', 'í‰íƒ„í™”', 
                    'ë°°ì„ ', 'ë„ì–´', 'í•˜ë¸Œ', 'ì•„í¬ë¦´', 'ì„ ë°˜', 'íƒˆê±°', 'ì²œì¥', 'ìŠ¬ë¼ì´ë”©'
                ];
                
                let isVehicleRelated = false;
                const fullText = (finalTitle + " " + finalContent).toLowerCase();
                
                for (const word of vehicleKeywords) {
                    if (fullText.includes(word.toLowerCase())) {
                        isVehicleRelated = true;
                        break;
                    }
                }

                // ì°¨ëŸ‰ ê´€ë ¨ì´ë©´ ì²´í¬ë°•ìŠ¤ ì¼œê¸°
                const vehicleCheckbox = document.getElementById('vehicleCheckbox');
                if (isVehicleRelated) {
                    vehicleCheckbox.checked = true;
                    showAlert(`ğŸš— ì°¨ëŸ‰ ê´€ë ¨ ìë£Œê°€ ê°ì§€ë˜ì–´\nìë™ìœ¼ë¡œ [ì°¨ëŸ‰] íƒ­ì— ì €ì¥í•©ë‹ˆë‹¤.`);
                } else {
                    vehicleCheckbox.checked = false;
                    showAlert(`âš¡ ê³µìœ ëœ ìë£Œë¥¼ ì €ì¥í•©ë‹ˆë‹¤.`);
                }

                // 4. ì €ì¥ ë²„íŠ¼ í™œì„±í™” ë° 0.5ì´ˆ ë’¤ ìë™ í´ë¦­
                updateSaveButtonState();
                
                setTimeout(() => {
                    // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ í›„ ì €ì¥
                    if (auth.currentUser) {
                        handleSave();
                        // URL íŒŒë¼ë¯¸í„° ì²­ì†Œ (ìƒˆë¡œê³ ì¹¨ ì‹œ ì¤‘ë³µ ì €ì¥ ë°©ì§€)
                        history.replaceState(null, '', window.location.pathname);
                    } else {
                        showAlert("ë¡œê·¸ì¸ì´ ì•ˆ ë˜ì–´ ìˆì–´ ìë™ ì €ì¥ì„ ëª»í–ˆìŠµë‹ˆë‹¤.\në¡œê·¸ì¸ í›„ ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
                    }
                }, 800); // 0.8ì´ˆ ë”œë ˆì´ (ë¡œê·¸ì¸ ë¡œë”© ì‹œê°„ ê³ ë ¤)
            }
        }
        initializeApp();

        // ==========================================
    // [ë¹„ë°€ ê¸ˆê³ ] 1. IndexedDB ì„¤ì • (ì´ê²Œ ìˆì–´ì•¼ ëˆì´ ì•ˆ ë“¬)
    // ==========================================
    let db;
    const DB_NAME = 'SecretVideoVault';
    const STORE_NAME = 'videos';

    const initDB = () => {
        return new Promise((resolve, reject) => {
            if (db) return resolve(db);
            const request = indexedDB.open(DB_NAME, 1);
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    db.createObjectStore(STORE_NAME);
                }
            };
            request.onsuccess = (event) => {
                db = event.target.result;
                resolve(db);
            };
            request.onerror = (event) => reject(event.target.error);
        });
    };

    async function getCachedVideo(url) {
        try {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.get(url);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        } catch (e) { return null; }
    }

    async function saveVideoToCache(url, blob) {
        try {
            const db = await initDB();
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.put(blob, url);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        } catch (e) { console.error(e); }
    }

    // ==========================================
    // [ë¹„ë°€ ê¸ˆê³ ] 2. ìŠ¤ë§ˆíŠ¸ ì¬ìƒ í•¨ìˆ˜ (ê¸°ì¡´ playVideo ëŒ€ì²´)
    // ==========================================
    async function playVideo(fileName, fileUrl) {
        const videoModal = document.getElementById('videoPlayerModal');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoTitle = document.getElementById('videoTitle');
        const container = document.getElementById('videoPlayerContainer');

        // ëª¨ë‹¬ ì—´ê¸°
        videoModal.style.display = 'flex';
        videoTitle.textContent = "ë¹„ë°€ ê¸ˆê³  í™•ì¸ ì¤‘...ğŸ•µï¸";
        videoPlayer.src = ""; 

        // ì œìŠ¤ì²˜ UI (ì—†ìœ¼ë©´ ìƒì„±)
        if (!document.querySelector('.gesture-left')) {
            const leftOverlay = document.createElement('div');
            leftOverlay.className = 'video-gesture-overlay gesture-left';
            leftOverlay.innerHTML = 'âª 10s';
            const rightOverlay = document.createElement('div');
            rightOverlay.className = 'video-gesture-overlay gesture-right';
            rightOverlay.innerHTML = '10s â©';
            container.style.position = 'relative';
            container.appendChild(leftOverlay);
            container.appendChild(rightOverlay);
        }

        try {
            // 1. ê¸ˆê³  í™•ì¸
            const cachedBlob = await getCachedVideo(fileUrl);

            if (cachedBlob) {
                // ê¸ˆê³ ì— ìˆìŒ -> ë¬´ë£Œ ì¬ìƒ
                videoTitle.textContent = "ğŸ”’ ì‹œí¬ë¦¿ ëª¨ë“œ (ë°ì´í„° ë¬´ë£Œ)";
                videoPlayer.src = URL.createObjectURL(cachedBlob);
            } else {
                // ê¸ˆê³ ì— ì—†ìŒ -> ë‹¤ìš´ë¡œë“œ(1íšŒ ë¹„ìš©) í›„ ì €ì¥
                videoTitle.textContent = "ğŸ“¥ ê¸ˆê³ ë¡œ ë‹¤ìš´ë¡œë“œ ì¤‘... (1íšŒë§Œ ì†Œëª¨)";
                const response = await fetch(fileUrl);
                const blob = await response.blob();
                await saveVideoToCache(fileUrl, blob);
                
                videoTitle.textContent = "ğŸ”’ ì €ì¥ ì™„ë£Œ! ì´ì œ í‰ìƒ ë¬´ë£Œ";
                videoPlayer.src = URL.createObjectURL(blob);
            }
            
            videoPlayer.play();
            videoPlayer.loop = true;

        } catch (error) {
            console.error("ì¬ìƒ ì˜¤ë¥˜:", error);
            videoTitle.textContent = fileName;
            videoPlayer.src = fileUrl; // ì˜¤ë¥˜ë‚˜ë©´ ê·¸ëƒ¥ ìŠ¤íŠ¸ë¦¬ë°
        }

        // ì œìŠ¤ì²˜ ë° í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë³µêµ¬
        let lastTapTime = 0;
        const handleTap = (e) => {
            const currentTime = new Date().getTime();
            const tapGap = currentTime - lastTapTime;
            const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            
            if (tapGap < 300 && tapGap > 0) {
                e.preventDefault(); 
                if (clientX < window.innerWidth * 0.4) {
                    videoPlayer.currentTime = Math.max(0, videoPlayer.currentTime - 10);
                    showRipple('.gesture-left');
                } else if (clientX > window.innerWidth * 0.6) {
                    videoPlayer.currentTime = Math.min(videoPlayer.duration, videoPlayer.currentTime + 10);
                    showRipple('.gesture-right');
                }
            }
            lastTapTime = currentTime;
        };

        function showRipple(selector) {
            const el = document.querySelector(selector);
            if(el) {
                el.classList.add('ripple-effect');
                el.style.opacity = '1';
                setTimeout(() => { el.style.opacity = '0'; el.classList.remove('ripple-effect'); }, 400);
            }
        }

        videoPlayer.removeEventListener('touchstart', handleTap);
        videoPlayer.addEventListener('touchstart', handleTap);

        // ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
        const closeBtn = videoModal.querySelector('.modal-close-btn');
        closeBtn.onclick = () => {
            videoPlayer.pause();
            videoPlayer.src = "";
            videoModal.style.display = 'none';
        };
    }
    </script>
</body>
</html>
